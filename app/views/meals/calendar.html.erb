<div class="container mx-auto max-w-6xl px-4 py-8">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-bold">Meal Calendar</h1>
      <p class="text-base-content/70 mt-1"><%= @start_of_month.strftime("%B %Y") %></p>
    </div>
    <div class="flex flex-wrap gap-2 items-center">
      <%= render "view_toggle", current_view: "calendar" %>
      <div class="hidden sm:flex gap-2">
        <%= link_to my_meals_meals_path, class: "btn btn-outline btn-sm" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          My Meals
        <% end %>
        <%= link_to meal_schedules_path, class: "btn btn-outline btn-sm" do %>
          Schedules
        <% end %>
      </div>
      <%= link_to new_meal_path, class: "btn btn-primary btn-sm" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
        </svg>
        <span class="hidden sm:inline">Add Meal</span>
      <% end %>
    </div>
  </div>

  <!-- Month Navigation -->
  <div class="flex justify-center gap-4 mb-6">
    <%= link_to calendar_meals_path(date: @start_of_month - 1.month), class: "btn btn-ghost btn-sm" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Previous
    <% end %>
    <%= link_to calendar_meals_path, class: "btn btn-ghost btn-sm" do %>
      Today
    <% end %>
    <%= link_to calendar_meals_path(date: @start_of_month + 1.month), class: "btn btn-ghost btn-sm" do %>
      Next
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    <% end %>
  </div>

  <!-- Mobile: Agenda View -->
  <div class="md:hidden space-y-2">
    <% (@start_of_month..@end_of_month).each do |date| %>
      <% is_today = date == Date.current %>
      <% day_meals = @meals_by_date[date] || [] %>

      <div class="flex gap-3 p-3 rounded-lg <%= is_today ? 'bg-primary/10 ring-2 ring-primary' : 'bg-base-200' %>">
        <!-- Date Column -->
        <div class="flex-shrink-0 w-12 text-center">
          <div class="text-xs text-base-content/60 uppercase"><%= date.strftime("%a") %></div>
          <div class="text-xl font-bold <%= is_today ? 'text-primary' : '' %>"><%= date.day %></div>
        </div>

        <!-- Meals Column -->
        <div class="flex-1 min-w-0">
          <% if day_meals.any? %>
            <div class="space-y-2">
              <% day_meals.each do |meal| %>
                <%= link_to meal_path(meal), class: "block p-2 rounded-lg bg-base-100 shadow-sm hover:shadow-md transition-shadow" do %>
                  <div class="font-medium text-sm"><%= meal.display_title %></div>
                  <div class="text-xs text-base-content/60 mt-0.5"><%= meal.time_display %></div>
                  <% if meal.needs_head_cook? %>
                    <div class="badge badge-warning badge-sm mt-1">Needs cook</div>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          <% else %>
            <div class="text-sm text-base-content/40 py-1">No meals</div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Desktop: Calendar Grid -->
  <div class="hidden md:grid grid-cols-7 gap-1">
    <!-- Day Headers -->
    <% %w[Mon Tue Wed Thu Fri Sat Sun].each do |day| %>
      <div class="text-center font-medium text-sm text-base-content/70 py-2 bg-base-200 rounded">
        <%= day %>
      </div>
    <% end %>

    <!-- Day Cells -->
    <% (@calendar_start..@calendar_end).each do |date| %>
      <% is_today = date == Date.current %>
      <% is_current_month = date.month == @start_of_month.month %>
      <% day_meals = @meals_by_date[date] || [] %>

      <div class="min-h-24 p-1 rounded-lg border <%= is_today ? 'bg-primary/10 border-primary border-2' : (is_current_month ? 'bg-base-100 border-base-300' : 'bg-base-200/50 border-base-300') %>">
        <div class="text-xs font-medium <%= is_today ? 'text-primary' : (is_current_month ? 'text-base-content' : 'text-base-content/40') %> mb-1 px-1">
          <%= date.day %>
        </div>

        <div class="space-y-0.5 overflow-y-auto max-h-20">
          <% day_meals.each do |meal| %>
            <%= link_to meal_path(meal), class: "block p-1 rounded bg-#{is_current_month ? 'base-200' : 'base-300/50'} hover:bg-base-300 transition-colors text-xs" do %>
              <div class="font-medium truncate <%= is_current_month ? '' : 'text-base-content/50' %>"><%= meal.display_title %></div>
              <% if meal.needs_head_cook? %>
                <div class="badge badge-warning badge-xs">Needs cook</div>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
