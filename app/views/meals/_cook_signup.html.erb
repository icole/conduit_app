<div id="cook_signup" class="card bg-base-100 shadow-xl scroll-mt-20">
  <div class="card-body">
    <h3 class="card-title text-lg">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
      </svg>
      Cooking Team
    </h3>

    <!-- Current Cooks -->
    <% if meal.cooks.any? %>
      <div class="space-y-3 mt-4">
        <% meal.meal_cooks.includes(:user).each do |mc| %>
          <div class="flex items-center justify-between p-3 bg-base-200 rounded-lg">
            <div class="flex items-center gap-3">
              <div class="avatar placeholder">
                <div class="bg-primary text-primary-content rounded-full w-10">
                  <span class="text-sm"><%= mc.user.name.first(2).upcase %></span>
                </div>
              </div>
              <div>
                <div class="font-medium"><%= mc.user.name %></div>
                <div class="text-sm">
                  <% if mc.head_cook? %>
                    <span class="badge badge-primary badge-sm">Head Cook</span>
                  <% else %>
                    <span class="badge badge-ghost badge-sm">Helper</span>
                  <% end %>
                </div>
              </div>
            </div>
            <% if mc.user == current_user %>
              <%= button_to withdraw_cook_meal_path(meal), method: :delete,
                  class: "btn btn-ghost btn-sm text-error" do %>
                Withdraw
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Signup Buttons -->
    <% if meal.rsvps_open? && !meal.cancelled? && !my_cook_signup %>
      <div class="mt-4 space-y-3">
        <% if meal.needs_head_cook? %>
          <div class="alert alert-warning">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <span>This meal needs a head cook!</span>
          </div>
        <% end %>

        <% if meal.cook_slots_available? %>
          <div class="flex flex-col sm:flex-row gap-2">
            <% if meal.needs_head_cook? %>
              <%= button_to volunteer_cook_meal_path(meal, role: "head_cook"), method: :post,
                  class: "btn btn-primary flex-1 gap-2 h-auto min-h-[2.5rem] py-2" do %>
                <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                <span class="whitespace-normal">Volunteer as Head Cook</span>
              <% end %>
            <% end %>
            <%= button_to volunteer_cook_meal_path(meal, role: "helper"), method: :post,
                class: "btn btn-outline flex-1 gap-2 h-auto min-h-[2.5rem] py-2" do %>
              <span class="whitespace-normal">Volunteer as Helper</span>
            <% end %>
          </div>
        <% else %>
          <div class="text-sm text-base-content/70">
            All cook positions are filled for this meal.
          </div>
        <% end %>
      </div>
    <% elsif my_cook_signup %>
      <div class="mt-4 alert alert-success">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        <span>You're signed up as <%= my_cook_signup.role_display.downcase %>!</span>
      </div>

      <!-- Guest count form for cooks -->
      <% if meal.rsvps_open? && !meal.cancelled? %>
        <%= form_with url: update_cook_meal_path(meal), method: :patch, class: "mt-4 p-4 bg-base-200 rounded-lg space-y-4" do |f| %>
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Bringing guests?</span>
            </label>
            <div class="flex items-center gap-3">
              <button type="button" class="btn btn-circle btn-outline btn-sm" onclick="const i=document.getElementById('cook_guests_count'); i.value=Math.max(0,parseInt(i.value||0)-1)">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                </svg>
              </button>
              <input type="text" inputmode="numeric" pattern="[0-9]*" name="meal_cook[guests_count]" id="cook_guests_count"
                     value="<%= my_cook_signup.guests_count %>"
                     class="input input-bordered w-16 text-lg font-semibold text-center">
              <button type="button" class="btn btn-circle btn-outline btn-sm" onclick="const i=document.getElementById('cook_guests_count'); i.value=Math.min(10,parseInt(i.value||0)+1)">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
              </button>
              <span class="text-sm text-base-content/70">extra guests</span>
            </div>
          </div>

          <button type="submit" class="btn btn-primary btn-sm">
            Update Guests
          </button>
        <% end %>
      <% elsif my_cook_signup.guests_count > 0 %>
        <div class="mt-4 text-sm text-base-content/70">
          + <%= my_cook_signup.guests_count %> guest<%= my_cook_signup.guests_count == 1 ? '' : 's' %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
