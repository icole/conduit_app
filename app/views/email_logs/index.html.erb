<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">Email Logs</h1>
  </div>

  <!-- Filter Tabs -->
  <div class="tabs tabs-boxed mb-6">
    <%= link_to email_logs_path, class: "tab #{@status_filter.blank? ? 'tab-active' : ''}" do %>
      All <span class="badge badge-sm ml-1"><%= @total_count %></span>
    <% end %>
    <%= link_to email_logs_path(status: "delivered"), class: "tab #{@status_filter == 'delivered' ? 'tab-active' : ''}" do %>
      Delivered <span class="badge badge-success badge-sm ml-1"><%= @delivered_count %></span>
    <% end %>
    <%= link_to email_logs_path(status: "failed"), class: "tab #{@status_filter == 'failed' ? 'tab-active' : ''}" do %>
      Failed <span class="badge badge-error badge-sm ml-1"><%= @failed_count %></span>
    <% end %>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <% if @email_logs.any? %>
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>To</th>
                <th>Subject</th>
                <th>Mailer</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% @email_logs.each do |log| %>
                <tr class="hover">
                  <td class="text-sm text-base-content/70">
                    <%= log.sent_at&.strftime("%b %d, %Y %l:%M %p") || log.created_at.strftime("%b %d, %Y %l:%M %p") %>
                  </td>
                  <td class="font-medium"><%= truncate(log.to, length: 30) %></td>
                  <td><%= truncate(log.subject, length: 40) %></td>
                  <td class="text-sm text-base-content/70">
                    <% if log.mailer_class.present? %>
                      <%= log.mailer_class %><% if log.mailer_action.present? %>#<%= log.mailer_action %><% end %>
                    <% else %>
                      <span class="opacity-50">-</span>
                    <% end %>
                  </td>
                  <td>
                    <% case log.status %>
                    <% when "delivered" %>
                      <span class="badge badge-success badge-sm">Delivered</span>
                    <% when "failed" %>
                      <span class="badge badge-error badge-sm">Failed</span>
                    <% else %>
                      <span class="badge badge-warning badge-sm">Pending</span>
                    <% end %>
                  </td>
                  <td>
                    <%= link_to "View", email_log_path(log), class: "btn btn-ghost btn-sm" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-8">
          <p class="text-base-content/70">No email logs found.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
