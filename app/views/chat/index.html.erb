<%# Community Chat - Web Interface %>
<div class="<%= turbo_native_app? ? '' : 'container mx-auto p-4' %>">
  <% unless turbo_native_app? %>
    <div class="mb-4">
      <h1 class="text-2xl font-bold">Community Chat</h1>
    </div>
  <% end %>

  <% if StreamChatClient.configured? %>
    <!-- Stream Chat React Container -->
    <%= stylesheet_link_tag "chat", "data-turbo-track": "reload" %>

    <div
      id="stream-chat-react"
      class="bg-base-100 <%= turbo_native_app? ? '' : 'rounded-lg shadow-lg border border-base-300' %>"
      style="height: <%= turbo_native_app? ? '100vh' : '75vh' %>"
      data-api-key="<%= StreamChatClient.api_key %>"
      data-user-token="<%= @stream_token %>"
      data-user-data="<%= @user_data.to_json %>"
    >
      <!-- Loading state -->
      <div class="flex items-center justify-center h-full">
        <div class="loading loading-spinner loading-lg"></div>
      </div>
    </div>

    <%= javascript_include_tag "chat", type: "module", "data-turbo-track": "reload" %>
  <% else %>
    <!-- Configuration Required -->
    <div class="alert alert-warning">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <div>
        <h3 class="font-bold">Stream Chat Not Configured</h3>
        <div class="text-sm">
          <p>To enable chat functionality:</p>
          <ol class="list-decimal list-inside mt-2">
            <li>Sign up for a free Stream account at <a href="https://getstream.io" target="_blank" class="link">getstream.io</a></li>
            <li>Create a new app in the Stream Dashboard</li>
            <li>Add your API Key and Secret to the .env file:
              <pre class="bg-base-300 p-2 rounded mt-1">
STREAM_API_KEY=your_api_key_here
STREAM_API_SECRET=your_api_secret_here</pre>
            </li>
            <li>Restart the Rails server</li>
          </ol>
        </div>
      </div>
    </div>
  <% end %>
</div>
