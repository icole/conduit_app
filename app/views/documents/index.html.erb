<% content_for :title, "Documents" %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <% if notice.present? %>
    <div class="alert alert-success mb-6">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span><%= notice %></span>
    </div>
  <% end %>

  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
    <h1 class="font-bold text-4xl">Documents</h1>
    <div class="flex gap-2">
      <% if ENV["GOOGLE_DRIVE_FOLDER_ID"].present? %>
        <%= link_to refresh_from_google_drive_documents_path, class: "btn btn-success" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Import from Community Docs
        <% end %>
      <% end %>
      <%= link_to new_document_path, class: "btn btn-primary" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Add Document
      <% end %>
    </div>
  </div>

  <% if @documents.any? %>
    <div class="card bg-base-100 shadow-xl mt-6">
      <div class="card-body p-0">
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>
                  <%= link_to documents_path(sort: 'title', direction: (params[:sort] == 'title' && params[:direction] == 'asc') ? 'desc' : 'asc') do %>
                    Title
                    <% if params[:sort] == 'title' %>
                      <%= params[:direction] == 'asc' ? 'â†‘' : 'â†“' %>
                    <% end %>
                  <% end %>
                </th>
                <th>
                  <%= link_to documents_path(sort: 'document_type', direction: (params[:sort] == 'document_type' && params[:direction] == 'asc') ? 'desc' : 'asc') do %>
                    Type
                    <% if params[:sort] == 'document_type' %>
                      <%= params[:direction] == 'asc' ? 'â†‘' : 'â†“' %>
                    <% end %>
                  <% end %>
                </th>
                <th>
                  <%= link_to documents_path(sort: 'created_at', direction: (params[:sort] == 'created_at' && params[:direction] == 'asc') ? 'desc' : 'asc') do %>
                    Created
                    <% if params[:sort] == 'created_at' || params[:sort].nil? %>
                      <%= (params[:direction] == 'asc') ? 'â†‘' : 'â†“' %>
                    <% end %>
                  <% end %>
                </th>
                <th class="text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @documents.each do |document| %>
                <tr>
                  <td>
                    <%= safe_google_drive_link(document, document.title, target: "_blank", class: "font-medium") || content_tag(:span, "-", class: "text-base-content/50") %>
                  </td>
                  <td>
                    <% badge_color = case document.document_type
                                     when 'Google Doc' then 'badge-info'
                                     when 'Google Sheet' then 'badge-success'
                                     when 'Google Slides' then 'badge-warning'
                                     else 'badge-ghost'
                                     end %>
                    <span class="badge <%= badge_color %> badge-sm">
                      <%= document.document_type %>
                    </span>
                  </td>
                  <td class="text-sm text-base-content/70">
                    <%= document.created_at.strftime("%b %d, %Y") %>
                  </td>
                  <td>
                    <div class="flex justify-end gap-2">
                      <%= button_to "Delete", document_path(document), method: :delete,
                          data: { turbo_confirm: "Are you sure?" },
                          class: "btn btn-xs btn-outline btn-error" %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% else %>
    <div class="card bg-base-100 shadow-md">
      <div class="card-body text-center">
        <div class="text-4xl mb-4">ðŸ“„</div>
        <h3 class="font-bold text-xl mb-2">No documents yet</h3>
        <p class="text-base-content/70 mb-4">Add your first document to link it to calendar events and decisions.</p>
        <%= link_to "Add Your First Document", new_document_path, class: "btn btn-primary mx-auto" %>
      </div>
    </div>
  <% end %>
</div>
