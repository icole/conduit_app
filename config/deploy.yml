service: conduit_app
image: <%= ENV["DOCKER_USERNAME"] %>/conduit_app

servers:
  web:
    - <%= ENV["CONDUIT_SERVER_IP"] %>

ssh:
  user: <%= ENV["CONDUIT_SSH_USER"] %>  # Your Google Cloud username

proxy:
  ssl: false  # Set to true if you have a domain
  host: <%= ENV["CONDUIT_SERVER_IP"] %>

registry:
  username: <%= ENV["DOCKER_USERNAME"] %>
  password:
    - KAMAL_REGISTRY_PASSWORD

env:
  secret:
    - RAILS_MASTER_KEY
    - GOOGLE_CLIENT_ID
    - GOOGLE_CLIENT_SECRET
    - CONDUIT_APP_DATABASE_PASSWORD
  clear:
    SOLID_QUEUE_IN_PUMA: true

volumes:
  - "conduit_app_storage:/rails/storage"

builder:
  arch: amd64